---
title: "Intro to SFAplus package"
author: "Vaclav Hausenblas"
date: "2016-04-01"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  ---
  
  This document shows and test basic routines of SFAplus package.
  
  ```{r}
# require(SFAplus)
# require(msm) # package for drawing from truncated-normal distribution
# require(data.table) # for more convenient data manipulation
```


### Example dataset

Lets generate some randomly simulated production data,

```{r}
# source("simulate_data.R")
require(SFAt)
data1 <- as.data.frame(sim_data(1000, z_coeff = c(15, 1, 1)))

```

and explore the production data and simulated inefficiency term.

```{r}
# require(GGally)
# ggpairs(dtDT)

plot(data1)
hist(data1$y)
hist(data1$u)
hist(data1$eps)

```
## SFA -- normal/t-normal model

```{r}

sfa1 <- SFAt::sfa.fit(y = data1$y,
                      X = cbind(a = data1$x1, b = data1$x2),
                      Z = NULL,    
                      dist = "hnorm",
                      spec  = NULL,
                      deb = F,
                      # control_opt = list(maxit = 300)
)

summary(sfa1)
```


```{r}
hist(SFAt:::u_cs_hnorm(sfa1, "BC"))
```


## SFA model with endogenous inefficiency mean 

```{r}

est <- SFAt::sfa.fit(y = data1$y,
                     X = cbind(a = data1$x1, b = data1$x2),
                     Z = cbind(c = data1$z1, d = data1$z2),
                     dist = "tnorm",
                     spec  = "bc95",
                     deb = F,
                     # opt_method = "Nelder-Mead",
                     opt_method = "L-BFGS-B",
                     control_opt = list(maxit = 5000)
)

est$coefficients
est$coefficients_Z
summary(est)
```

```{r}
hist(SFAt:::u_cs_tnorm_bc95(est, "BC"))
```


## OLS model

We might be interested in simple OLS model for LR test (and starting values of parameters).

```{r}

lmfit <- lm(y ~ x1 + x2 + I(-z1) + I(-z2), data = data1)
summary(lmfit)

```


